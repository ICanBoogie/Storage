# Storage

[![Release](https://img.shields.io/packagist/v/icanboogie/storage.svg)](https://github.com/ICanBoogie/Storage/releases)
[![Build Status](https://img.shields.io/travis/ICanBoogie/Storage/master.svg)](http://travis-ci.org/ICanBoogie/Storage)
[![HHVM](https://img.shields.io/hhvm/icanboogie/storage.svg)](http://hhvm.h4cc.de/package/icanboogie/storage)
[![Code Quality](https://img.shields.io/scrutinizer/g/ICanBoogie/Storage/master.svg)](https://scrutinizer-ci.com/g/ICanBoogie/Storage)
[![Code Coverage](https://img.shields.io/coveralls/ICanBoogie/Storage/master.svg)](https://coveralls.io/r/ICanBoogie/Storage)
[![Packagist](https://img.shields.io/packagist/dt/icanboogie/storage.svg)](https://packagist.org/packages/icanboogie/storage)

The **icanboogie/storage** package defines an API to store and retrieve values, while offering different storage backends.

Values can be stored using the runtime memory, [Redis][], [APC][], the file systemâ€¦ Storage collections are used to retrieve and store values using multiple different storage instances, that usually range from the less expensive (and the more volatile) to the more expensive (and the more durable).

The following storages are included in this package:

- [RunTimeStorage][]: Uses a PHP array.
- [RedisStorage][]: Uses a [Redis][] instance.
- [APCStorage][]: Uses [APC][] or [APCu][].
- [FileStorage][]: Uses the file system.
- [StorageCollection][]: Uses a collection of storages.





## Storage

A storage is used to store a value and retrieve it later. A unique key is used to identify the value. Different storages store values using different mechanisms, and sometimes for a different period of time. It's always a good idea to choose the storage that best fits a situation, according to the persistence requirement and the expensiveness of the storage.

Storage classes implement the [Storage][] interface, including the [StorageCollection][] class.

```php
<?php

use ICanBoogie\Storage\RunTimeStorage;

$storage = new RunTimeStorage;
$storage->exists('icanboogie');     // false
$storage->retrieve('icanboogie');   // null
$storage->store('icanboogie', "Yes Sir I Can Boogie");
$storage->retrieve('icanboogie');   // "Yes Sir, I Can Boogie"
$storage->eliminate('icanboogie');
$storage->exists('icanboogie');     // false
$storage->retrieve('icanboogie');   // null
```

Storage classes also implement the `ArrayAccess` interface, and use the [ArrayAccessTrait][] trait, and can be accessed as arrays.

```php
<?php

use ICanBoogie\Storage\RunTimeStorage;

$storage = new RunTimeStorage;
isset($storage['icanboogie']);     // false
$storage['icanboogie'];            // null
$storage['icanboogie'] = "Yes Sir I Can Boogie";
$storage['icanboogie'];            // "Yes Sir, I Can Boogie"
unset($storage['icanboogie']);
isset($storage['icanboogie']);     // false
$storage['icanboogie'];            // null
```





## Storage collection

When implementing caches, it's always a good idea to use a collection of [Storage][] instances that range from the less expensive (and the more volatile) to the more expensive (and the more durable).

The following example demonstrates how a storage collection can be created with multiple storage instances:

```php
<?php

use ICanBoogie\Storage\StorageCollection;
use ICanBoogie\Storage\RunTimeStorage;
use ICanBoogie\Storage\APCStorage;
use ICanBoogie\Storage\RedisStorage;
use ICanBoogie\Storage\FileStorage;

$storage = new StorageCollection([

	new RunTimeStorage,
	new APCStorage('my-prefix'),
	new RedisStorage($redis_client, 'my-prefix'),
	new FileStorage('/path/to/directory')

]);
```

All the storage instances in the collection are updated by the `store()`, `eliminate()`, and `clear()` methods. Storage instances are also updated when values are retrieved from _more expensive_ storages, so that the next time the value is requested it is retrieved from a less expensive storage.






----------





## Requirements

The package requires PHP 5.5 or later.





## Installation

The recommended way to install this package is through [Composer](http://getcomposer.org/):

```
composer require icanboogie/storage
```





### Cloning the repository

The package is [available on GitHub](https://github.com/ICanBoogie/Storage), its repository can be cloned with the following command line:

	$ git clone https://github.com/ICanBoogie/Storage.git





## Documentation

The package is documented as part of the [ICanBoogie][] framework
[documentation](http://icanboogie.org/docs/). The documentation is generated by [ApiGen](http://apigen.org/), using the `make doc` command, in the `build/docs` directory. The directory can later be cleaned with the `make clean` command.





## Testing

The test suite is ran with the `make test` command. [PHPUnit](https://phpunit.de/) and [Composer](http://getcomposer.org/) need to be globally available to run the suite. The command installs dependencies as required. The `make test-coverage` command runs test suite and also creates an HTML coverage report in "build/coverage". The directory can later be cleaned with the `make clean` command.

The package is continuously tested by [Travis CI](http://about.travis-ci.org/).

[![Build Status](https://img.shields.io/travis/ICanBoogie/Storage/master.svg)](https://travis-ci.org/ICanBoogie/Storage)
[![Code Coverage](https://img.shields.io/coveralls/ICanBoogie/Storage/master.svg)](https://coveralls.io/r/ICanBoogie/Storage)





## License

**icanboogie/storage** is licensed under the New BSD License - See the [LICENSE](LICENSE) file for details.





[APC]: http://php.net/manual/en/book.apc.php
[APCu]: https://github.com/krakjoe/apcu
[ArrayAccessTrait]: http://icanboogie.org/docs/namespace-ICanBoogie.Storage.ArrayAccessTrait.html
[ICanBoogie]: https://github.com/ICanBoogie/ICanBoogie
[Redis]: http://redis.io/
[RunTimeStorage]: http://icanboogie.org/docs/namespace-ICanBoogie.Storage.RunTimeStorage.html
[RedisStorage]: http://icanboogie.org/docs/namespace-ICanBoogie.Storage.RedisStorage.html
[APCStorage]: http://icanboogie.org/docs/namespace-ICanBoogie.Storage.APCStorage.html
[FileStorage]: http://icanboogie.org/docs/namespace-ICanBoogie.Storage.FileStorage.html
[Storage]: http://icanboogie.org/docs/namespace-ICanBoogie.Storage.Storage.html
[StorageCollection]: http://icanboogie.org/docs/namespace-ICanBoogie.Storage.StorageCollection.html
